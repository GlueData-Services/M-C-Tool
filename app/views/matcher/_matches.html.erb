<div class="refine d-flex justify-content-between my-4">
  <h4 class="d-inline">Match Results</h4>
  <div class="search">
    <%= form_tag matcher_path, method: :get do %>
      Refine results <%= search_field_tag :q, params[:q] %>
      <%= submit_tag 'Go' %>
    <% end %>
  </div>
</div>

<%= form_tag create_match_path do %>
  <% if @matched.blank? %>
    <div class="text-center">
      <span class="alert alert-secondary text-center">No results to display, select an item from the top panel to start a search.</span>
    </div>
  <% else %>
    <table class="table table-sm table-bordered table-hover">
      <thead>
      <tr>
        <th>Banner</th>
        <th>Description</th>
        <th>Article Type</th>
        <th>Barcodes</th>
        <th>Score</th>
        <th></th>
      </tr>
      </thead>

      <tbody>
      <% @matched && @matched.with_highlights.each do |mara, highlight| %>
        <tr class="<%= mara.banner.downcase %> <%= mara.barcodes.split(',').join(" ") %>">
          <td><span><%= mara.banner %></span></td>
          <td><%== highlight[:description] %></td>
          <td><%= mara.article_type %></td>
          <td>
            <% if highlight[:barcodes] %>
              <span data-bs-toggle="tooltip" data-bs-placement="bottom" title="<%= mara.barcodes %>"><%= truncate highlight[:barcodes]&.html_safe, length: 50 %></span>
            <% else %>
              <span data-bs-toggle="tooltip" data-bs-placement="bottom" title="<%= mara.barcodes %>"><%= truncate mara.barcodes, length: 50 %></span>
            <% end %>
          </td>
          <!--        <td>-->
          <%# mara.barcodes.split(',').each do |b| %>
          <!--            <span class="badge rounded-pill bg-light text-dark barcode"><%#= b %></span>-->
          <%# end %>
          <!--        </td>-->
          <td><%= @scores[mara.prefixed_matnr] %></td>
          <td class="text-center"><%= check_box_tag 'p_matnr[]', mara.prefixed_matnr %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
    <div class="text-end">
      <%= button_tag 'Create match and continue', value: :continue, class: 'btn btn-primary' %>
      <%= button_tag 'Create match and consolidate', value: :consolidate, class: 'btn btn-secondary' %>
    </div>
  <% end %>
<% end %>
