<section class="header container mt-4">
  <div class="d-none">
    <%= form_tag dash_search_path do %>
      <%= text_field_tag :q %>
      <%= submit_tag 'Search' %>
    <% end %>

    <hr>

    <% if @search.present? %>
      <h2>Search results: <%= @search.size %></h2>
      <% @search.each do |r| %>
        <p><%= r.inspect %></p>
      <% end %>
    <% end %>

  </div>
</section>

<section class="content" id="welcome">
  <div class="container">
    <div class="row mt-5">
      <div class="col-4">
        <a href="/matcher" class="btn btn-lg btn-outline-dark w-100 p-4 bg-white shadow poh">
          <i class="bi bi-diagram-3" style="font-size: 3rem;"></i>
          <br>
          Matcher
        </a>
      </div>
      <div class="col-4">
        <a href="<%= consolidation_path %>" class="btn btn-lg btn-outline-dark w-100 p-4 bg-white shadow poh">
          <i class="bi bi-link-45deg" style="font-size: 3rem;"></i>
          <br>
          Consolidation
        </a>
      </div>
      <div class="col-4">
        <a href="/reports" class="btn btn-lg btn-outline-dark w-100 p-4 bg-white shadow poh">
          <i class="bi bi-graph-up" style="font-size: 3rem;"></i>
          <br>
          Reports
        </a>
      </div>
    </div>

    <div class="row mt-5">
      <div class="col-6">
        <h2>Match Status</h2>

        <div class="card">
          <div class="card-body">
            <table class="table table-borderless">
              <tr>
                <th colspan=2>Stats for <span class="color-gd">all</span> articles</th>
              </tr>
              <tr>
                <th>Total Articles</th>
                <td class="text-end"><%= Mara.count %></td>
              </tr>
              <tr>
                <th>Total Matched Articles</th>
                <td class="text-end"><%= MatchedArticle.all.count %></td>
              </tr>
              <tr>
                <td colspan=2>
                  <div class="progress">
                    <div class="progress-bar progress-bar-striped  progress-bar-animated" role="progressbar" style="width: <%= (Match.count.to_f / Mara.count) * 100 %>%"></div>
                  </div>
                </td>
              </tr>
              <tr>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <th colspan=2>Stats for <span class="color-gd">active</span> articles</th>
              </tr>
              <tr>
                <th>Total Active Articles</th>
                <td class="text-end"><%= Mara.active.count %></td>
              </tr>
              <tr>
                <th>Matched Active Articles</th>
                <td class="text-end"><%= Mara.active.matched.count %></td>
              </tr>
              <tr>
                <th>Unmatched Active Articles</th>
                <td class="text-end"><%= Mara.unmatched.active.count %></td>
              </tr>
              <tr>
                <td colspan="2">
                  <div class="progress">
                    <div class="progress-bar progress-bar-striped  progress-bar-animated bg-success" role="progressbar" style="width: <%= (Mara.active.matched.count.to_f / Mara.active.count) * 100 %>%"></div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>


      <div class="col-6">
        <h2>Consolidation Status</h2>
        <div class="card card-sidebar-secondary">
          <div class="card-body">
            <table class="table table-borderless">
              <tr>
                <th>Total Match Sets</th>
                <td><%= Match.all.count %></td>
              </tr>
              <tr>
                <th>Awaiting Consolidation</th>
                <td><%= Match.incomplete.count %></td>
              </tr>
              <tr>
                <th>Consolidated</th>
                <td><%= Match.complete.count %></td>
              </tr>
              <tr>
                <th>Problem Matches</th>
                <td><%= Match.in_error.count %></td>
              </tr>
            </table>
          </div>
        </div>
      </div>

    </div>

    <div class="row mt-5">
      <div class="col-6">
        <div class="card">
          <div class="card-body">
            <table class="table table-borderless">
              <tr>
                <th>Matches yesterday</th>
                <td class="text-end"><%= Match.where('DATE(created_at) = ?', Date.today - 1.day).count %></td>
              </tr>
              <tr>
                <th>Matches today</th>
                <td class="text-end"><%= Match.where('DATE(created_at) = ?', Date.today).count %></td>
              </tr>
              <tr>
                <th>Match Velocity</th>
                <td class="text-end">0</td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <div class="col-6">
        <div class="card card-sidebar-secondary">
          <div class="card-body">
            <table class="table table-borderless">
              <tr>
                <th>Consolidated today</th>
                <td></td>
              </tr>
              <tr>
                <th>Consolidated yesterday</th>
                <td></td>
              </tr>
              <tr>
                <th>Velocity</th>
                <td></td>
              </tr>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

</section>

